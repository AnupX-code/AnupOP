<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Neon Snake Game</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: black;
      color: white;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    canvas {
      background-color: #111;
      box-shadow: 0 0 40px #0ff;
    }
    .overlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2;
    }
    .overlay button {
      padding: 10px 20px;
      margin: 10px;
      font-size: 1.2em;
      border: none;
      border-radius: 8px;
      background: #0ff;
      color: #000;
      cursor: pointer;
      transition: 0.2s;
    }
    .overlay button:hover {
      background: #0cf;
    }
    #scoreDisplay {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 1.5em;
      color: #0ff;
    }
  </style>
</head>
<body>

<canvas id="gameCanvas" width="600" height="600"></canvas>

<div class="overlay" id="overlay">
  <h1>🔥 Anup welcomes you to the game 🔥</h1>
  <button id="startBtn">Start Game</button>
</div>

<div class="overlay" id="gameOverScreen" style="display:none;">
  <h2>Game Over</h2>
  <p id="finalScoreText">Score: 0</p>
  <button id="restartBtn">Restart</button>
</div>

<div id="scoreDisplay">Score: 0</div>

<!-- Audio files -->
<audio id="startSound" src="start.mp3" preload="auto"></audio>
<audio id="restartSound" src="restart.mp3" preload="auto"></audio>
<audio id="eatSound" src="eat.mp3" preload="auto"></audio>
<audio id="gameOverSound" src="gameover.mp3" preload="auto"></audio>
<audio id="bgMusic" src="music.mp3" loop preload="auto"></audio>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const gridSize = 20;
const tileCount = canvas.width / gridSize;

let snake = [
  { x: 10, y: 10 },
  { x: 9, y: 10 }
];
let direction = { x: 1, y: 0 };
let nextDirection = { x: 1, y: 0 };
let food = randomFood();
let score = 0;
let lastTime = 0;
let overlay = document.getElementById("overlay");
let startBtn = document.getElementById("startBtn");
let restartBtn = document.getElementById("restartBtn");
let gameOverScreen = document.getElementById("gameOverScreen");
let finalScoreText = document.getElementById("finalScoreText");
let scoreDisplay = document.getElementById("scoreDisplay");

const startSound = document.getElementById("startSound");
const restartSound = document.getElementById("restartSound");
const eatSound = document.getElementById("eatSound");
const gameOverSound = document.getElementById("gameOverSound");
const bgMusic = document.getElementById("bgMusic");

const bodyImg = new Image();
bodyImg.src = "snake_body.png";

const mangoImg = new Image();
mangoImg.src = "mango.png";

function randomFood() {
  return {
    x: Math.floor(Math.random() * tileCount),
    y: Math.floor(Math.random() * tileCount)
  };
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Draw food
  ctx.drawImage(mangoImg, food.x * gridSize, food.y * gridSize, gridSize, gridSize);

  // Draw snake
  snake.forEach((segment, index) => {
    let sx = segment.x * gridSize;
    let sy = segment.y * gridSize;
    if (index === 0) {
      ctx.fillStyle = '#0ff';
      ctx.beginPath();
      ctx.arc(sx + gridSize/2, sy + gridSize/2, gridSize * 0.35, 0, Math.PI * 2);
      ctx.fill();
    } else {
      ctx.drawImage(bodyImg, sx, sy, gridSize, gridSize);
    }
  });

  // Move
  direction = nextDirection;
  const head = {
    x: snake[0].x + direction.x,
    y: snake[0].y + direction.y
  };

  // Wall or self hit
  if (
    head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount ||
    snake.some((s, i) => i > 0 && s.x === head.x && s.y === head.y)
  ) {
    gameOver();
    return;
  }

  snake.unshift(head);

  if (head.x === food.x && head.y === food.y) {
    eatSound.play();
    score++;
    updateScore();
    food = randomFood();
  } else {
    snake.pop();
  }
}

function updateScore() {
  scoreDisplay.textContent = "Score: " + score;
}

function gameOver() {
  gameOverSound.play();
  bgMusic.pause();
  gameOverScreen.style.display = "flex";
  finalScoreText.textContent = `Score: ${score} 🐍 | Rank: ${getRank(score)}`;
  cancelAnimationFrame(gameLoopId);
}

function getRank(score) {
  if (score >= 30) return "🔥 Legend";
  if (score >= 20) return "😎 Pro";
  if (score >= 10) return "🙂 Intermediate";
  if (score >= 5) return "🫠 Newbie";
  return "👶 Baby Snake";
}

function gameLoop(timestamp) {
  if (timestamp - lastTime > 100) {
    draw();
    lastTime = timestamp;
  }
  gameLoopId = requestAnimationFrame(gameLoop);
}

function initGame() {
  snake = [
    { x: 10, y: 10 },
    { x: 9, y: 10 }
  ];
  direction = { x: 1, y: 0 };
  nextDirection = { x: 1, y: 0 };
  food = randomFood();
  score = 0;
  lastTime = 0;
  overlay.style.display = 'none';
  gameOverScreen.style.display = 'none';
  updateScore();
  bgMusic.currentTime = 0;
  bgMusic.play();
  requestAnimationFrame(gameLoop);
}

startBtn.addEventListener('click', () => {
  startSound.currentTime = 0;
  startSound.play().then(() => {
    setTimeout(() => initGame(), 200); // slight delay so sound plays first
  }).catch(() => initGame());
});

restartBtn.addEventListener('click', () => {
  restartSound.currentTime = 0;
  restartSound.play().then(() => {
    setTimeout(() => initGame(), 200);
  }).catch(() => initGame());
});

document.addEventListener("keydown", e => {
  const dirs = {
    ArrowUp: { x: 0, y: -1 },
    ArrowDown: { x: 0, y: 1 },
    ArrowLeft: { x: -1, y: 0 },
    ArrowRight: { x: 1, y: 0 }
  };
  if (dirs[e.key]) {
    const newDir = dirs[e.key];
    if (!(newDir.x === -direction.x && newDir.y === -direction.y)) {
      nextDirection = newDir;
    }
  }
});
</script>

</body>
</html>
